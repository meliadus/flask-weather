{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">
    {{ 'Личный кабинет' if lang == 'ru' else 'Account' }}
</h1>

<div class="mb-3 text-end">
    <a href="{{ url_for('logout') }}" class="btn btn-secondary">
        {{ 'Выйти' if lang == 'ru' else 'Logout' }}
    </a>
</div>

{% if role == 'admin' %}
  <h3 class="mb-3">{{ 'Все заказы' if lang == 'ru' else 'All orders' }}</h3>
  <table class="table table-dark table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>{{ 'Пользователь' if lang=='ru' else 'User' }}</th>
        <th>{{ 'Товары' if lang=='ru' else 'Items' }}</th>
        <th class="text-end">{{ 'Сумма' if lang=='ru' else 'Total' }}</th>
        <th>{{ 'Оплата' if lang=='ru' else 'Payment' }}</th>
        <th>{{ 'Статус' if lang=='ru' else 'Status' }}</th>
        <th>{{ 'Дата' if lang=='ru' else 'Date' }}</th>
        <th>{{ 'Действия' if lang=='ru' else 'Actions' }}</th>
      </tr>
    </thead>
    <tbody>
      {% for o in orders %}
      <tr>
        <td>{{ o.id }}</td>
        <td>{{ o.username }}</td>
        <td style="max-width: 420px;">{{ o.items_text }}</td>
        <td class="text-end">{{ o.total }} NOK</td>
        <td>{{ o.payment }}</td>
        <td style="min-width: 210px;">
          <form method="post" action="/update_order/{{ o.id }}" class="d-flex gap-2">
            <select name="status_code" class="form-select form-select-sm">
              {% for code, labels in status_choices %}
                <option value="{{ code }}" {% if o.status_code == code %}selected{% endif %}>
                  {{ labels[lang] }}
                </option>
              {% endfor %}
            </select>
            <button class="btn btn-sm btn-primary">
              {{ 'Сохранить' if lang=='ru' else 'Save' }}
            </button>
          </form>
        </td>
        <td>{{ o.date }}</td>
        <td>
          <a href="/delete_order/{{ o.id }}" class="btn btn-sm btn-danger"
             onclick="return confirm('{{ 'Удалить заказ?' if lang=='ru' else 'Delete order?' }}');">
            {{ 'Удалить' if lang=='ru' else 'Delete' }}
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

{% else %}
  <h3 class="mb-3">{{ 'Мои заказы' if lang == 'ru' else 'My Orders' }}</h3>
  <table class="table table-dark table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>{{ 'Товары' if lang=='ru' else 'Items' }}</th>
        <th class="text-end">{{ 'Сумма' if lang=='ru' else 'Total' }}</th>
        <th>{{ 'Оплата' if lang=='ru' else 'Payment' }}</th>
        <th>{{ 'Статус' if lang=='ru' else 'Status' }}</th>
        <th>{{ 'Дата' if lang=='ru' else 'Date' }}</th>
      </tr>
    </thead>
    <tbody>
      {% for o in orders %}
      <tr>
        <td>{{ o.id }}</td>
        <td style="max-width: 520px;">{{ o.items_text }}</td>
        <td class="text-end">{{ o.total }} NOK</td>
        <td>{{ o.payment }}</td>
        <td>
          {% if status_choices %}
            {% for code, labels in status_choices %}
              {% if code == o.status_code %}
                {{ labels[lang] }}
              {% endif %}
            {% endfor %}
          {% else %}
            {{ o.status_label }}
          {% endif %}
        </td>

        <td>{{ o.date }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% endblock %}
